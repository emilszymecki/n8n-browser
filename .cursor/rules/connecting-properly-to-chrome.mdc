---
description: zasady Å‚Ä…czenia siÄ™ z chromem
globs: 
alwaysApply: false
---
# Connecting Properly to Chrome with Playwright

## âœ… OPTYMALNE ROZWIÄ„ZANIE - Chrome DevTools Protocol (CDP)

**Metoda:** `chromium.connectOverCDP()` po uruchomieniu Chrome z debug portem

### ğŸš€ Krok 1: Uruchom Chrome z debug portem
```bash
npm run launch-chrome
```

Lub rÄ™cznie:
```javascript
// launch-chrome.js - sprawdzony kod ktÃ³ry DZIAÅA
const chromePath = findChrome(); // Automatycznie znajdzie Chrome
const args = [
    '--remote-debugging-port=9222',
    `--user-data-dir=${userDataDir}`,
    '--disable-popup-blocking',
    '--disable-dev-shm-usage', 
    '--disable-setuid-sandbox',
    '--no-sandbox',
    '--ignore-certificate-errors',
    '--ignore-ssl-errors',
    '--ignore-certificate-errors-spki-list',
    '--enable-features=NetworkService',
    '--no-first-run',
    '--no-default-browser-check'
];

spawn(chromePath, args);
```

### ğŸ”— Krok 2: PoÅ‚Ä…cz siÄ™ przez CDP
```javascript
import { chromium } from 'playwright';

const browser = await chromium.connectOverCDP('http://localhost:9222');
const context = browser.contexts[0]; // UÅ¼ywamy pierwszego kontekstu
context.setDefaultTimeout(120000); // 2 minuty timeout

const page = await context.newPage();
await page.goto('https://wp.pl');
console.log(`ğŸ“– TytuÅ‚: ${await page.title()}`);
```

### ğŸ’¡ Dlaczego CDP jest optymalne:
1. **Separacja procesÃ³w** - Chrome dziaÅ‚a niezaleÅ¼nie
2. **MoÅ¼liwoÅ›Ä‡ ponownego poÅ‚Ä…czenia** - jeÅ›li skrypt siÄ™ zatrzyma, Chrome dalej dziaÅ‚a
3. **DostÄ™p do istniejÄ…cych sesji** - moÅ¼esz uÅ¼ywaÄ‡ juÅ¼ zalogowanych kont
4. **StabilnoÅ›Ä‡** - Chrome nie zostanie zamkniÄ™ty gdy skrypt siÄ™ koÅ„czy
5. **Kontrola nad cyklem Å¼ycia** - moÅ¼esz zarzÄ…dzaÄ‡ Chrome niezaleÅ¼nie
6. **Debugowanie** - http://localhost:9222 pozwala podglÄ…daÄ‡ co siÄ™ dzieje

## âœ… SPRAWDZONE ARGUMENTY CHROME

Te argumenty sÄ… przetestowane i dziaÅ‚ajÄ… idealnie:
```javascript
const args = [
    '--remote-debugging-port=9222',
    '--disable-popup-blocking',
    '--disable-dev-shm-usage', 
    '--disable-setuid-sandbox',
    '--no-sandbox',
    '--ignore-certificate-errors',
    '--ignore-ssl-errors',
    '--ignore-certificate-errors-spki-list',
    '--enable-features=NetworkService',
    '--no-first-run',
    '--no-default-browser-check'
];
```

## ğŸ”„ WORKFLOW KTÃ“RY DZIAÅA

1. **Uruchom Chrome:** `npm run launch-chrome` (raz)
2. **ÅÄ…cz siÄ™ wielokrotnie:** `npm run auto` / `npm run manual`
3. **Chrome dziaÅ‚a w tle** - moÅ¼na wielokrotnie Å‚Ä…czyÄ‡/rozÅ‚Ä…czaÄ‡ skrypty
4. **SprawdÅº status:** http://localhost:9222 - lista dostÄ™pnych stron

## âŒ ALTERNATYWNE METODY (mniej optymalne)

### `launchPersistentContext()` - drugie miejsce
```javascript
const browser = await chromium.launchPersistentContext(userDataDir, {
    headless: false,
    args: ['--disable-popup-blocking', ...]
});
```
**Wady:** Zamyka Chrome gdy skrypt siÄ™ koÅ„czy, mniej kontroli

### `browser.launch()` - trzecie miejsce  
**Wady:** KaÅ¼de uruchomienie = nowa sesja, brak persistencji

## ğŸ¯ TRYBY PRACY

### Manual Mode (`npm run manual`)
- NieskoÅ„czony timeout
- Pozwala na rÄ™czne logowanie (LinkedIn, Facebook)
- Cookies sÄ… zachowywane w `browser-data/`

### Auto Mode (`npm run auto`) 
- Automatyczna praca
- UÅ¼ywa zapisanych cookies
- Szybkie wykonanie zadaÅ„

## âœ… TESTOWANE I POTWIERDZONE
- **Status:** âœ… DZIAÅA IDEALNIE  
- **Data:** 2024
- **Åšrodowisko:** Windows, Node.js, Playwright
- **Testowane z:** wp.pl, n8n, HTTP server, LinkedIn, Facebook
- **Port:** 9222 (sprawdzony)
- **User Data:** `browser-data/` (persistent)